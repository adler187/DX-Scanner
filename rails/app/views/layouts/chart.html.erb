<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<title>Signal Graph for <%= @station.callsign %></title>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js" type="text/javascript"></script>
	<%= javascript_include_tag "highcharts/highcharts" %>
	<%= javascript_include_tag "highcharts/themes/gray" %>
	<script>
var chart;
$(document).ready(function() {
   chart = new Highcharts.Chart({
      chart:
      {
         renderTo: 'container',
         zoomType: 'x',
         spacingRight: 20
      },
       title:
       {
         text: 'Signal Strength for <%= @station.callsign %> on tuner <%= @tuner.name %>'
      },
       subtitle:
       {
         text: document.ontouchstart === undefined ?
            'Click and drag in the plot area to zoom in' :
            'Drag your finger over the plot to zoom in'
      },
      xAxis:
      {
         type: 'datetime',
         maxZoom: 14 * 24 * 3600000, // fourteen days
         title:
         {
            text: null
         }
      },
      yAxis:
      {
         title:
         {
            text: 'Signal Strength'
         },
         min: 0,
         max: 100,
         startOnTick: false,
         showFirstLabel: false,
         plotBands:
         [
			{
				from: 0,
				to: 50,
				color: 'rgba(255, 0, 0, 0.1)'
			},
			{
				from: 51,
				to: 75,
				color: 'rgba(255, 255, 0, 0.1)'
			},
			{
				from: 76,
				to: 100,
				color: 'rgba(0, 255, 0, 0.1)'
			}
		]
      },
      tooltip:
      {
         shared: true
      },
      legend:
      {
         enabled: true
      },
      series:
      [
		{
         name: 'Signal Strength',
         pointInterval: 24 * 3600 * 1000,
         pointStart: Date.parse('<%= @station.logs[0].created_at %>'),
         data:
         [
			<%= @data.collect { |log| log[:signal_strength] }.join ',' %>
         ]
		},
		{
         name: 'Signal to Noise Ratio',
         pointInterval: 24 * 3600 * 1000,
         pointStart: Date.parse('<%= @station.logs[0].created_at %>'),
         data:
         [
			<%= @data.collect { |log| log[:signal_to_noise] }.join ',' %>
         ]
		},
		{
         name: 'Signal Quality',
         pointInterval: 24 * 3600 * 1000,
         pointStart: Date.parse('<%= @station.logs[0].created_at %>'),
         data:
         [
			<%= @data.collect { |log| log[:signal_quality] }.join ',' %>
         ]
		}
      ]
   });


});
	</script>
</head>
<body>
<%= yield %>
</body>
</html>
