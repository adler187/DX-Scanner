<% require 'maps' %>

var list = $('logs-list');
var infoWindow;
var marker;
var item;
var list_item;

list.innerHTML = '';
map.removeMarkers();

<% @logs.each do |log| %>

infoWindow = new google.maps.InfoWindow({ content: '<%= info_window(log) %>' });

google.maps.event.addListener(infoWindow, 'closeclick', map.clearActiveMarker.bind(map));

marker = map.addMarker
(
	{
		position: new google.maps.LatLng(<%= log.station.latitude %>, <%= log.station.longitude %>),
		draggable: false,
		clickable: true,
		title: "<%= log.station.callsign %>",
		zIndex: 0,
		icon: "<%= get_marker_image(log.signal_strength) %>",
		infoWindow: infoWindow
	}
);

google.maps.event.addListener(marker, 'click', marker.click.bind(marker));

item = document.createElement('span');
item.innerHTML = '<%= log.station.callsign %>';

item.className = 'clickable';

Event.observe(item, 'click', marker.click.bind(marker));

list_item = document.createElement('li');
list_item.appendChild(item);

list.appendChild(list_item);

<% end %>
